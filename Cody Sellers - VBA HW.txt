Sub VBA_Stocks()

'Variables

Dim ticker As String
Dim stock_close As Double
Dim stock_volume As Long
Dim InitialRowCount As Long
Dim LastBlankRow As Long
Dim StockPriceStart As Double
Dim StockPriceEnd As Double
Dim YearlyChange As Double
Dim PercentChange As Double
Dim SecondRowCount As Long
Dim GreatestPercentIncrease As Double
Dim GreatestPercentDecrease As Double
Dim GreatestStockVolume As Double

StockPriceStart = 0

For Each ws In Worksheets

'Find total count of values in Row 1.

InitialRowCount = ws.Cells(Rows.Count, 1).End(xlUp).Row

'Check if ticker of current sell is the same as the next cell. If it is - keep running total of volume.

For a = 2 To InitialRowCount

ticker = ws.Cells(a, 1).Value
            
If ticker = ws.Cells(a + 1, 1).Value Then
VolumeTotal = VolumeTotal + ws.Cells(a, 7).Value
            
        'Check to see if StockPriceStart has a value. If yes, skip. If no, set the value to the current cell.
            
    If StockPriceStart > 0 Then
    StockPriceStart = StockPriceStart
            
    Else: StockPriceStart = ws.Cells(a, 6).Value
        
    End If
        
'Once a change in stock ticker is dedectied - we add the current sell to VolumeTotal and Print values.

Else
            
VolumeTotal = VolumeTotal + ws.Cells(a, 7).Value
            
StockPriceEnd = ws.Cells(a, 6).Value
YearlyChange = StockPriceEnd - StockPriceStart

    If StockPriceEnd = 0 Or StockPriceStart = 0 Then
    PercentChange = 0
    
    Else
    PercentChange = (StockPriceEnd - StockPriceStart) / StockPriceEnd
    
    End If
            
LastBlankRow = ws.Cells(Rows.Count, 9).End(xlUp).Row + 1
ws.Cells(LastBlankRow, 9).Value = ticker
            
LastBlankRow = ws.Cells(Rows.Count, 12).End(xlUp).Row + 1
ws.Cells(LastBlankRow, 12).Value = VolumeTotal
            
LastBlankRow = ws.Cells(Rows.Count, 10).End(xlUp).Row + 1
ws.Cells(LastBlankRow, 10).Value = YearlyChange
        
        If YearlyChange >= 0 Then
        ws.Cells(LastBlankRow, 10).Interior.ColorIndex = 4
        
        Else
        ws.Cells(LastBlankRow, 10).Interior.ColorIndex = 3
        
        End If

LastBlankRow = ws.Cells(Rows.Count, 11).End(xlUp).Row + 1
ws.Cells(LastBlankRow, 11) = Format(0.5768, "0.00%")
ws.Cells(LastBlankRow, 11).Value = PercentChange
            
VolumeTotal = 0
StockPriceStart = 0
 
End If

Next a

SecondRowCount = ws.Cells(Rows.Count, 9).End(xlUp).Row
GreatestPercentIncrease = 0
GreatestPercentDecrease = 0
GreatestStockVolume = 0

For b = 2 To SecondRowCount

    If ws.Cells(b, 11).Value > GreatestPercentIncrease Then
    GreatestPercentIncrease = ws.Cells(b, 11).Value
    ws.Cells(2, 16).Value = ws.Cells(b, 9).Value
    ws.Cells(2, 17) = Format(0.5768, "0.00%")
    ws.Cells(2, 17).Value = GreatestPercentIncrease
    
    ElseIf ws.Cells(b, 11).Value < GreatestPercentDecrease Then
    GreatestPercentDecrease = ws.Cells(b, 11).Value
    ws.Cells(3, 16).Value = ws.Cells(b, 9).Value
    ws.Cells(3, 17) = Format(0.5768, "0.00%")
    ws.Cells(3, 17).Value = GreatestPercentDecrease
    
    End If
    
    If ws.Cells(b, 12).Value > GreatestStockVolume Then
    GreatestStockVolume = ws.Cells(b, 12).Value
    ws.Cells(4, 16).Value = ws.Cells(b, 9).Value
    ws.Cells(4, 17).Value = GreatestStockVolume
    
    End If
    
Next b

Next ws

End Sub

